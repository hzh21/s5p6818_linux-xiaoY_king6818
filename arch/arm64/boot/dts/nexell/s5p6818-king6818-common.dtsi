/*
 * (C) Copyright 2026 Gemini / King6818 Porting Project
 * Cleaned version: Removed duplicate labels and fixed hierarchy
 */

/memreserve/ 0x7de00000 0x00100000;
#include <dt-bindings/interrupt-controller/irq.h>
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include "s5p6818.dtsi"

/ {
	model = "Rongpin King6818 Board";
	compatible = "rongpin,king6818", "nexell,s5p6818";

	memory {
		device_type = "memory";
		reg = <0x40000000 0x3db00000>;
	};

	aliases {
		ethernet0 = &gmac0;
		i2c3 = &i2c_3;
		serial0 = &serial0; /* 确保别名指向正确的串口 */
	};

	soc {
		#include "s5p6818-pinctrl.dtsi"

		/* 修正：这里只放真正的时钟控制器或频率定义 */
		clocks {
			uart0_clk: uart0-clk { 
				compatible = "fixed-clock";
				#clock-cells = <0>;
				clock-frequency = <147456000>; /* 修正为标准的晶振倍频 */
			};
		};

		/* 修正：串口应该直接在 soc 节点下 */
		serial0: serial@c00a1000 {
			status = "okay";
			clocks = <&pclk>, <&uart0_clk>;
			clock-names = "uart", "clk_uartbaud";
		};

		/* 修正：补全 I2C3 控制器定义 */
		i2c_3: i2c@c00a7000 {
			compatible = "nexell,s5p6818-i2c";
			reg = <0xc00a7000 0x100>;
			interrupts = <0 47 0>;
			clock-names = "i2c";
			clocks = <&pclk>;
			status = "okay";
		};

		/* 修正：补充 pinctrl 节点定义 */
		pinctrl@c0010000 {
			i2c3_pins: i2c3-pins {
				nexell,pins = "gpioc-15", "gpioc-16";
				nexell,pin-function = <1>;
				nexell,pin-pull = <2>;
				nexell,pin-strength = <0>;
			};
		};

		gmac0: ethernet@c0060000 {
			status = "okay";
			snps,phy-addr = <3>;
			mdio {
				#address-cells = <1>;
				#size-cells = <0>;
				ethernet_phy: ethernet-phy@3 { reg = <3>; };
			};
		};
	};
};

/* 在根节点外追加 AXP228 逻辑 */
&i2c_3 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c3_pins>;

	axp228@34 {
		compatible = "x-powers,axp228";
		reg = <0x34>;
		status = "okay";
		regulators {
			vdd_arm: axp22_dcdc2 {
				regulator-name = "vdd_arm";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <1540000>;
				regulator-always-on;
				regulator-boot-on;
			};
		};
	};
};
