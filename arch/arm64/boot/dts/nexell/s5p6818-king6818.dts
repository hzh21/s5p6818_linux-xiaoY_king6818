/*
 * (C) Copyright 2026 Gemini / King6818 Porting Project
 * Based on FriendlyElec & Rongpin SDK
 */

/dts-v1/;
#include "s5p6818-king6818-common.dtsi"

/ {
    model = "Rongpin King6818 Board";
    compatible = "rongpin,king6818", "nexell,s5p6818";

    /* 释放被占用的引脚资源，确保 I2C3 独占 GPIOC15/16 */
    /delete-node/ onewire_pwm; 
};

&mach {
    hwrev = <1>;
    model = "King6818";
};

/* 1. 修复网卡：荣品 King6818 的 PHY 地址必须是 3 */
&gmac0 {
    status = "okay";
    snps,phy-addr = <3>;
    mdio {
        #address-cells = <1>;
        #size-cells = <0>;
        ethernet_phy: ethernet-phy@3 {
            reg = <3>;
        };
    };
};

/* 2. 修复电源：禁用原有模拟 I2C，改用硬件 I2C3 驱动 AXP228 */
/delete-node/ &i2c3_gpio; 

&i2c_3 {
    status = "okay";
    samsung,i2c-max-bus-freq = <100000>;
    pinctrl-names = "default";
    pinctrl-0 = <&i2c3_pins>; /* 引用下方定义的 ALT1 模式 */

    #address-cells = <1>;
    #size-cells = <0>;

    axp228@34 {
        compatible = "x-powers,axp228";
        reg = <0x34>;
        status = "okay";
        interrupt-parent = <&alive_0>;
        interrupts = <4 IRQ_TYPE_EDGE_FALLING>;
        
        /* 电压配置保持 common 中的默认值即可 */
    };
};

/* 3. 修正引脚功能：将 C15/C16 切换为硬件 I2C3 模式 (FUNC1) */
&pinctrl@C0010000 {
    i2c3_pins: i2c3-pins {
        nexell,pins = "gpioc-15", "gpioc-16";
        nexell,pin-function = <1>; /* 对应荣品源码中的 NX_PIN_FUNC1 */
        nexell,pin-pull = <2>;     /* I2C 必须开启上拉 */
        nexell,pin-strength = <0>;
    };
};

&dw_mmc_1 {
    status = "okay";
};

&simple_card {
    simple-audio-card,dai-link@0 {
        hp-det-gpio = <&gpio_b 27 0>;
    };
};

&spi_0 {
    /delete-node/ fbtft@0;
};
